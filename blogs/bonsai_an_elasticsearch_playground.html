<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta charset="utf-8"/>
<meta name="generator" content="Docutils 0.16: http://docutils.sourceforge.net/" />
<title>Bonsai: An Elasticsearch playground</title>
<script src="../static/script/test.js"></script>
<style type="text/css">

/* Minimal style sheet for the HTML output of Docutils.                    */
/*                                                                         */
/* :Author: Günter Milde, based on html4css1.css by David Goodger          */
/* :Id: $Id: minimal.css 8397 2019-09-20 11:09:34Z milde $               */
/* :Copyright: © 2015 Günter Milde.                                        */
/* :License: Released under the terms of the `2-Clause BSD license`_,      */
/*    in short:                                                            */
/*                                                                         */
/*    Copying and distribution of this file, with or without modification, */
/*    are permitted in any medium without royalty provided the copyright   */
/*    notice and this notice are preserved.                                */
/*                                                                         */
/*    This file is offered as-is, without any warranty.                    */
/*                                                                         */
/* .. _2-Clause BSD license: http://www.spdx.org/licenses/BSD-2-Clause     */

/* This CSS2.1_ stylesheet defines rules for Docutils elements without    */
/* HTML equivalent. It is required to make the document semantic visible. */
/*                                                                        */
/* .. _CSS2.1: http://www.w3.org/TR/CSS2                                  */
/* .. _validates: http://jigsaw.w3.org/css-validator/validator$link       */

/* alignment of text and inline objects inside block objects*/
.align-left   { text-align: left; }
.align-right  { text-align: right; }
.align-center { clear: both; text-align: center; }
.align-top    { vertical-align: top; }
.align-middle { vertical-align: middle; }
.align-bottom { vertical-align: bottom; }

/* titles */
h1.title, p.subtitle {
  text-align: center;
}
p.topic-title,
p.sidebar-title,
p.rubric,
p.admonition-title,
p.system-message-title {
  font-weight: bold;
}
h1 + p.subtitle,
h1 + p.section-subtitle {
  font-size: 1.6em;
}
h2 + p.section-subtitle { font-size: 1.28em; }
p.subtitle,
p.section-subtitle,
p.sidebar-subtitle {
  font-weight: bold;
  margin-top: -0.5em;
}
p.sidebar-title,
p.rubric {
  font-size: larger;
}
p.rubric { color: maroon; }
a.toc-backref {
  color: black;
  text-decoration: none; }

/* Warnings, Errors */
div.caution p.admonition-title,
div.attention p.admonition-title,
div.danger p.admonition-title,
div.error p.admonition-title,
div.warning p.admonition-title,
div.system-messages h1,
div.error,
span.problematic,
p.system-message-title {
  color: red;
}

/* inline literals */
span.docutils.literal {
  font-family: monospace;
  white-space: pre-wrap;
}
/* do not wraph at hyphens and similar: */
.literal > span.pre { white-space: nowrap; }

/* Lists */

/* compact and simple lists: no margin between items */
.simple  li, .compact li,
.simple  ul, .compact ul,
.simple  ol, .compact ol,
.simple > li p, .compact > li p,
dl.simple > dd, dl.compact > dd {
  margin-top: 0;
  margin-bottom: 0;
}

/* Table of Contents */
div.topic.contents { margin: 0.5em 0; }
div.topic.contents ul {
  list-style-type: none;
  padding-left: 1.5em;
}

/* Enumerated Lists */
ol.arabic     { list-style: decimal }
ol.loweralpha { list-style: lower-alpha }
ol.upperalpha { list-style: upper-alpha }
ol.lowerroman { list-style: lower-roman }
ol.upperroman { list-style: upper-roman }

dt span.classifier { font-style: italic }
dt span.classifier:before {
  font-style: normal;
  margin: 0.5em;
  content: ":";
}

/* Field Lists and drivatives */
/* bold field name, content starts on the same line */
dl.field-list > dt,
dl.option-list > dt,
dl.docinfo > dt,
dl.footnote > dt,
dl.citation > dt {
  font-weight: bold;
  clear: left;
  float: left;
  margin: 0;
  padding: 0;
  padding-right: 0.5em;
}
/* Offset for field content (corresponds to the --field-name-limit option) */
dl.field-list > dd,
dl.option-list > dd,
dl.docinfo > dd {
  margin-left:  9em; /* ca. 14 chars in the test examples */
}
/* start field-body on a new line after long field names */
dl.field-list > dd > *:first-child,
dl.option-list > dd > *:first-child
{
  display: inline-block;
  width: 100%;
  margin: 0;
}
/* field names followed by a colon */
dl.field-list > dt:after,
dl.docinfo > dt:after {
  content: ":";
}

/* Bibliographic Fields (docinfo) */
pre.address { font: inherit; }
dd.authors > p { margin: 0; }

/* Option Lists */
dl.option-list { margin-left: 1.5em; }
dl.option-list > dt { font-weight: normal; }
span.option { white-space: nowrap; }

/* Footnotes and Citations  */
dl.footnote.superscript > dd {margin-left: 1em; }
dl.footnote.brackets > dd {margin-left: 2em; }
dl > dt.label { font-weight: normal; }
a.footnote-reference.brackets:before,
dt.label > span.brackets:before { content: "["; }
a.footnote-reference.brackets:after,
dt.label > span.brackets:after { content: "]"; }
a.footnote-reference.superscript,
dl.footnote.superscript > dt.label {
  vertical-align: super;
  font-size: smaller;
}
dt.label > span.fn-backref { margin-left: 0.2em; }
dt.label > span.fn-backref > a { font-style: italic; }

/* Line Blocks */
div.line-block { display: block; }
div.line-block div.line-block {
  margin-top: 0;
  margin-bottom: 0;
  margin-left: 40px;
}

/* Figures, Images, and Tables */
.figure.align-left,
figure.align-left,
img.align-left,
object.align-left,
table.align-left {
  margin-right: auto;
}
.figure.align-center,
figure.align-center,
img.align-center,
object.align-center,
table.align-center {
  margin-left: auto;
  margin-right: auto;
}
.figure.align-right,
figure.align-right,
img.align-right,
object.align-right,
table.align-right {
  margin-left: auto;
}
.figure.align-center, .figure.align-right,
figure.align-center, figure.align-right,
img.align-center, img.align-right,
object.align-center, object.align-right {
  display: block;
}
/* reset inner alignment in figures and tables */
.figure.align-left, .figure.align-right,
figure.align-left, figure.align-right,
table.align-left, table.align-center, table.align-right {
  text-align: inherit;
}

/* Admonitions and System Messages */
div.admonition,
div.system-message,
div.sidebar,
aside.sidebar {
  margin: 1em 1.5em;
  border: medium outset;
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  padding-right: 1em;
  padding-left: 1em;
}

/* Sidebar */
div.sidebar,
aside.sidebar {
  width: 30%;
  max-width: 26em;
  float: right;
  clear: right;
}

/* Text Blocks */
blockquote,
div.topic,
pre.literal-block,
pre.doctest-block,
pre.math,
pre.code {
  margin-left: 1.5em;
  margin-right: 1.5em;
}
pre.code .ln { color: gray; } /* line numbers */

/* Tables */
table { border-collapse: collapse; }
td, th {
  border-style: solid;
  border-color: silver;
  padding: 0 1ex;
  border-width: thin;
}
td > p:first-child, th > p:first-child { margin-top: 0; }
td > p, th > p { margin-bottom: 0; }

table > caption {
  text-align: left;
  margin-bottom: 0.25em
}

table.borderless td, table.borderless th {
  border: 0;
  padding: 0;
  padding-right: 0.5em /* separate table cells */
}

/* Document Header and Footer */
/* div.header,				      */
/* header { border-bottom: 1px solid black; } */
/* div.footer,				      */
/* footer { border-top: 1px solid black; }    */

/* new HTML5 block elements: set display for older browsers */
header, section, footer, aside, nav, main, article, figure {
  display: block;
}

</style>
<style type="text/css">

/* CSS31_ style sheet for the output of Docutils HTML writers.             */
/* Rules for easy reading and pre-defined style variants.		   */
/*                                                                         */
/* :Author: Günter Milde, based on html4css1.css by David Goodger          */
/* :Id: $Id: plain.css 8397 2019-09-20 11:09:34Z milde $               */
/* :Copyright: © 2015 Günter Milde.                                        */
/* :License: Released under the terms of the `2-Clause BSD license`_,      */
/*    in short:                                                            */
/*                                                                         */
/*    Copying and distribution of this file, with or without modification, */
/*    are permitted in any medium without royalty provided the copyright   */
/*    notice and this notice are preserved.                                */
/*    	     	      	     	 					   */
/*    This file is offered as-is, without any warranty.                    */
/*                                                                         */
/* .. _2-Clause BSD license: http://www.spdx.org/licenses/BSD-2-Clause     */
/* .. _CSS3: http://www.w3.org/TR/CSS3		        		   */


/* Document Structure */
/* ****************** */

/* "page layout" */
body {
  margin: 0;
  background-color: #dbdbdb;
}
div.document,
main {
  line-height:1.3;
  counter-reset: table;
  /* counter-reset: figure; */
  /* avoid long lines --> better reading */
  /* OTOH: lines should not be too short because of missing hyphenation, */
  max-width: 50em;
  padding: 1px 2%; /* 1px on top avoids grey bar above title (mozilla) */
  margin: auto;
  background-color: white;
}

/* Sections */

/* Transitions */

hr.docutils {
  width: 80%;
  margin-top: 1em;
  margin-bottom: 1em;
  clear: both;
}

/* Paragraphs */
/* ========== */

/* vertical space (parskip) */
p, ol, ul, dl,
div.line-block,
div.topic,
table {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}
p:first-child { margin-top: 0; }
/* (:last-child is new in CSS 3) */
p:last-child  { margin-bottom: 0; }

h1, h2, h3, h4, h5, h6,
dl > dd {
  margin-bottom: 0.5em;
}

/* Lists */
/* ===== */

/* Definition Lists */

/* lists nested in definition lists */
/* (:only-child is new in CSS 3) */
dd > ul:only-child, dd > ol:only-child { padding-left: 1em; }

/* Description Lists */
/* styled like in most dictionaries, encyclopedias etc. */
dl.description > dt {
  font-weight: bold;
  clear: left;
  float: left;
  margin: 0;
  padding: 0;
  padding-right: 0.5em;
}

/* Field Lists */

/* example for custom field-name width */
dl.field-list.narrow > dd {
  margin-left: 5em;
}
/* run-in: start field-body on same line after long field names */
dl.field-list.run-in > dd p {
  display: block;
}

/* Bibliographic Fields */

/* generally, bibliographic fields use special definition list dl.docinfo */
/* but dedication and abstract are placed into "topic" divs */
div.abstract p.topic-title {
  text-align: center;
}
div.dedication {
  margin: 2em 5em;
  text-align: center;
  font-style: italic;
}
div.dedication p.topic-title {
  font-style: normal;
}

/* Citations */
dl.citation dt.label {
  font-weight: bold;
}
span.fn-backref {
  font-weight: normal;
}

/* Text Blocks */
/* =========== */

/* Literal Blocks */

pre.literal-block,
pre.doctest-block,
pre.math,
pre.code {
  font-family: monospace;
}

/* Block Quotes */

blockquote > table,
div.topic > table {
  margin-top: 0;
  margin-bottom: 0;
}
blockquote p.attribution,
div.topic p.attribution {
  text-align: right;
  margin-left: 20%;
}

/* Tables */
/* ====== */

/* th { vertical-align: bottom; } */

table tr { text-align: left; }

/* "booktabs" style (no vertical lines) */
table.booktabs {
  border: 0;
  border-top: 2px solid;
  border-bottom: 2px solid;
  border-collapse: collapse;
}
table.booktabs * {
  border: 0;
}
table.booktabs th {
  border-bottom: thin solid;
}

/* numbered tables (counter defined in div.document) */
table.numbered > caption:before {
  counter-increment: table;
  content: "Table " counter(table) ": ";
  font-weight: bold;
}

/* Explicit Markup Blocks */
/* ====================== */

/* Footnotes and Citations */
/* ----------------------- */

/* line on the left */
dl.footnote {
  padding-left: 1ex;
  border-left: solid;
  border-left-width: thin;
}

/* Directives */
/* ---------- */

/* Body Elements */
/* ~~~~~~~~~~~~~ */

/* Images and Figures */

/* let content flow to the side of aligned images and figures */
.figure.align-left,
figure.align-left,
img.align-left,
object.align-left {
  display: block;
  clear: left;
  float: left;
  margin-right: 1em;
}
.figure.align-right,
figure.align-right,
img.align-right,
object.align-right {
  display: block;
  clear: right;
  float: right;
  margin-left: 1em;
}
/* Stop floating sidebars, images and figures at section level 1,2,3 */
h1, h2, h3 { clear: both; }

/* Sidebar */

/* Move right. In a layout with fixed margins, */
/* it can be moved into the margin.   	       */
div.sidebar,
aside.sidebar {
  width: 30%;
  max-width: 26em;
  margin-left: 1em;
  margin-right: -2%;
  background-color: #ffffee;
}

/* Code */

pre.code { padding: 0.7ex }
pre.code, code { background-color: #eeeeee }
pre.code .ln { color: gray; } /* line numbers */
/* basic highlighting: for a complete scheme, see */
/* http://docutils.sourceforge.net/sandbox/stylesheets/ */
pre.code .comment, code .comment { color: #5C6576 }
pre.code .keyword, code .keyword { color: #3B0D06; font-weight: bold }
pre.code .literal.string, code .literal.string { color: #0C5404 }
pre.code .name.builtin, code .name.builtin { color: #352B84 }
pre.code .deleted, code .deleted { background-color: #DEB0A1}
pre.code .inserted, code .inserted { background-color: #A3D289}

/* Math */
/* styled separately (see math.css for math-output=HTML) */

/* Epigraph           */
/* Highlights         */
/* Pull-Quote         */
/* Compound Paragraph */
/* Container          */

/* can be styled in a custom stylesheet */

/* Document Header and Footer */

footer, header,
div.footer, div.header {
  font-size: smaller;
  clear: both;
  padding: 0.5em 2%;
  background-color: #ebebee;
  border: none;
}

/* Inline Markup */
/* ============= */

/* Emphasis           */
/*   em               */
/* Strong Emphasis    */
/*   strong	      */
/* Interpreted Text   */
/*   span.interpreted */
/* Title Reference    */
/*   cite	      */

/* Inline Literals                                          */
/* possible values: normal, nowrap, pre, pre-wrap, pre-line */
/*   span.docutils.literal { white-space: pre-wrap; }       */

/* Hyperlink References */
a { text-decoration: none; }

/* External Targets       */
/*   span.target.external */
/* Internal Targets  	  */
/*   span.target.internal */
/* Footnote References    */
/*   a.footnote-reference */
/* Citation References    */
/*   a.citation-reference */

</style>
<style type="text/css">

/* style for keyboard key rendering */
.kbd {
    -moz-border-radius:3px;
    -moz-box-shadow:0 1px 0 rgba(0,0,0,0.2),0 0 0 2px #fff inset;
    -webkit-border-radius:3px;
    -webkit-box-shadow:0 1px 0 rgba(0,0,0,0.2),0 0 0 2px #fff inset;
    background-color:#f7f7f7;
    border:1px solid #ccc;
    border-radius:3px;
    box-shadow:0 1px 0 rgba(0,0,0,0.2),0 0 0 2px #fff inset;
    color:#333;
    display:inline-block;
    font-family:Arial,Helvetica,sans-serif;
    font-size:15px;
    line-height:1.4;
    margin:0 .1em;
    padding:.1em .6em;
    text-shadow:0 1px 0 #fff;
}


/* this one fixes the overflow problem for sidebar*/
h1, h2, h3 { 
    clear: none;     
}

/* strike through is not supported in rST this enables it*/
.strike {
  text-decoration: line-through;
}

</style>
</head>
<body>
<div class="document" id="bonsai-an-elasticsearch-playground">
<h1 class="title">Bonsai: An Elasticsearch playground</h1>

<p><a class="reference external" href="../blog.html">&lt; Blog</a></p>
<p>Experimenting with Elasticsearch using Bonsai.</p>
<p>Created on: 2019-03-15</p>
<p>If you are getting started with Elasticsearch and don't want to setup an Elasticsearch instance, Bonsai is here to rescue. Bonsai is a free Elasticsearch hosting service where we can experiment with Elasticsearch. With the free plan Bonsai provides one cluster with  10k docs, 125MB data, 10 shards and 125MB memory. It may doesn't look a lot but it would definitely give a tailwind on you getting started to Elasticsearch journey.</p>
<p>To get started head over to <a class="reference external" href="https://bonsai.io/">Bonsai</a> and sign up. Once we get the confirmation mail we can head over to Bonsai and <a class="reference external" href="https://app.bonsai.io/login">Log in</a>.</p>
<p>After successful login we should get redirected to the cluster creation page. There we need to give a name of our cluster, in this case, I am using <span class="docutils literal">demo_for_blog</span>. Then we need to choose server region. While choosing the server rescue, keep latency in mind and choose the one closest to your location. We don't have much option when it comes to choosing version and plan as we are using free plan.</p>
<p>Upon successful cluster creation we should see the Overview tab of the cluster. I will give a brief intro of all the tabs on this page.</p>
<p>First we see the Overview page on successful cluster creation. It shows the Status, Region and Elasticsearch Version on top. We should also see <span class="docutils literal">Launch Kibana</span> button on that same row. This page also shows the Cluster Usage and Performance info of last 24 hours.</p>
<p>Then we have Metrics tab. It shows, you got it, different metrics for this cluster like Request Counts, Requests (Counts &amp; Duration), Request Duration Percentiles, Queue time, Concurrency, Bandwidth, Response Codes. The metrics can be seen over the time of 28d, 7d, 1d and 1h. More on how to read the metrics data can be found on <a class="reference external" href="https://docs.bonsai.io/article/131-cluster-metrics">How to read your metrics</a> doc.</p>
<p>Next to Metrics we have Manage tab. It all about the cluster management and shows info for Current Plan, Current Limits, Update Plan, Trim Logs and Datadog Integration.</p>
<p>The Console tab is quite interesting. It is an interactive web-based UI for interacting with our cluster. Here we can run all the curl equvelent commands to interact with our cluster.</p>
<p>The next tab is Logs which shows log either for Recent Requests or for Top 20 Slow Requests.</p>
<p>The Access tab is where we generate our API token to use it from other application. One of the cons of free plan is there is no read-only access which sucks.</p>
<p>The last tab is Deprovision. When we are done with experimentation, we should deprovision our cluster. We can do that by entering the password for our account and clicking on <span class="docutils literal">Enter Password to Deprovision</span> button.</p>
<p>Just to give an intro we will use our <span class="docutils literal">demo_for_blog</span> cluster and create a new index, update it's mapping, upload 5 data and search for one and update one.</p>
<p>Before we start we will create a generate a new token from the Access tab and use that to perform our operation. Once we enter the name on the Add Credential section and click Generate New Token it should redirected us to a new page where we should see the Access Key and Access Secret for the user. A full URL will also be provided. Keep this 3 things safe. Now if we take a look at the URL is should follow the following schema:</p>
<pre class="literal-block">https://randomuser:randompass&#64;cluster_name-ramdom_number.cluster_region.bonsaisearch.net</pre>
<p>For example, I get this full URL:</p>
<pre class="literal-block">https://isdrWzc7nq:3MuCsPLpNRU9ofgA4GY&#64;demo-for-blog-6448511871.eu-central-1.bonsaisearch.net</pre>
<p>Now we are ready to start playing around.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Most of the commands bellow usages <span class="docutils literal">curl</span> so make sure you have <span class="docutils literal">curl</span> installed. Same results can be achieved using the Console tab as well.</p>
</div>
<div class="section" id="create-an-index">
<h1>Create an index</h1>
<p>Index in Elasticsearch is much like a table of a database. Let's list all the indexes of our instance:</p>
<pre class="literal-block">curl -XGET &quot;https://isdrWzc7nq:3MuCsPLpNRU9ofgA4GY&#64;demo-for-blog-6448511871.eu-central-1.bonsaisearch.net/_cat/indices?v&quot;</pre>
<p>We can see in the following output that we don't have any index as of now.:</p>
<pre class="literal-block">health    status    index    uuid                     pri    rep    docs.count    docs.deleted    store.size    pri.store.size</pre>
<p>To create an index name <cite>demo</cite> using <span class="docutils literal">curl</span>:</p>
<pre class="literal-block">curl -XPUT &quot;https://isdrWzc7nq:3MuCsPLpNRU9ofgA4GY&#64;demo-for-blog-6448511871.eu-central-1.bonsaisearch.net/demo?pretty&amp;pretty&quot;</pre>
<p>If we are using the Console, we just need to change the verb from the drop down to <span class="docutils literal">PUT</span> and enter index name demo and press enter. In both case, we should see the following message on successful index creation:</p>
<pre class="literal-block">{
  &quot;acknowledged&quot; : true,
  &quot;shards_acknowledged&quot; : true,
  &quot;index&quot; : &quot;demo&quot;
}</pre>
<p>Let's list all the indexes using the same previous command:</p>
<pre class="literal-block">curl -XGET &quot;https://isdrWzc7nq:3MuCsPLpNRU9ofgA4GY&#64;demo-for-blog-6448511871.eu-central-1.bonsaisearch.net/_cat/indices?v&quot;</pre>
<p>We can see in the following output that we have created an index named <span class="docutils literal">demo</span>:</p>
<pre class="literal-block">health    status    index    uuid                     pri    rep    docs.count    docs.deleted    store.size    pri.store.size
green     open      demo     wHOxKkbhTxSd1eVG7MWhdw   1      1      0             0               460b          230b</pre>
</div>
<div class="section" id="update-mapping">
<h1>Update Mapping</h1>
<p>Mapping defines how the data will be stored on that table. Let's check the mapping of our index:</p>
<pre class="literal-block">curl -XGET &quot;https://isdrWzc7nq:3MuCsPLpNRU9ofgA4GY&#64;demo-for-blog-6448511871.eu-central-1.bonsaisearch.net/demo/_mapping?pretty&amp;pretty&quot;</pre>
<p>We can see from the following output that mapping for our index is not defined.:</p>
<pre class="literal-block">{
  &quot;demo&quot;: {
    &quot;mappings&quot;: {}
  }
}</pre>
<p>Let's update he mapping our index:</p>
<pre class="literal-block">curl -XPUT &quot;https://isdrWzc7nq:3MuCsPLpNRU9ofgA4GY&#64;demo-for-blog-6448511871.eu-central-1.bonsaisearch.net/demo/_mapping/v1&quot; -H 'Content-Type: application/json' -d'
{
    &quot;v1&quot;: {
      &quot;properties&quot;: {
        &quot;name&quot;:     { &quot;type&quot;: &quot;text&quot;  },
        &quot;age&quot;:      { &quot;type&quot;: &quot;integer&quot; }
      }
    }
}'</pre>
<p>For the Console just put /demo/_mapping/v1 on the URL input box paste the following in the box bellow and then press enter:</p>
<pre class="literal-block">{
    &quot;v1&quot;: {
      &quot;properties&quot;: {
        &quot;name&quot;:     { &quot;type&quot;: &quot;text&quot;  },
        &quot;age&quot;:      { &quot;type&quot;: &quot;integer&quot; }
      }
    }
}</pre>
<p>In both case we should see the following message:</p>
<pre class="literal-block">{
  &quot;acknowledged&quot;: true
}</pre>
<p>Checking the mapping using the same <span class="docutils literal">curl</span> command now shows:</p>
<pre class="literal-block">{
    &quot;demo&quot;: {
        &quot;mappings&quot;: {
            &quot;v1&quot;: {
                &quot;properties&quot;: {
                    &quot;age&quot;: {
                        &quot;type&quot;: &quot;integer&quot;
                    },
                    &quot;name&quot;: {
                        &quot;type&quot;: &quot;text&quot;
                    }
                }
            }
        }
    }
}</pre>
<p>So it seems we have updated our mapping!!!</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We could have defined the mapping while creating the index but for this blog we choose not to do so.</p>
</div>
</div>
<div class="section" id="uploading-data">
<h1>Uploading Data</h1>
<p>We have defined how to store the data. Now let's upload some:</p>
<pre class="literal-block">curl -XPOST &quot;https://isdrWzc7nq:3MuCsPLpNRU9ofgA4GY&#64;demo-for-blog-6448511871.eu-central-1.bonsaisearch.net/demo/v1?pretty&amp;pretty&quot; -H 'Content-Type: application/json' -d' { &quot;name&quot;: &quot;user1&quot;, &quot;age&quot;: 10 }'
curl -XPOST &quot;https://isdrWzc7nq:3MuCsPLpNRU9ofgA4GY&#64;demo-for-blog-6448511871.eu-central-1.bonsaisearch.net/demo/v1?pretty&amp;pretty&quot; -H 'Content-Type: application/json' -d' { &quot;name&quot;: &quot;user2&quot;, &quot;age&quot;: 20 }'
curl -XPOST &quot;https://isdrWzc7nq:3MuCsPLpNRU9ofgA4GY&#64;demo-for-blog-6448511871.eu-central-1.bonsaisearch.net/demo/v1?pretty&amp;pretty&quot; -H 'Content-Type: application/json' -d' { &quot;name&quot;: &quot;user3&quot;, &quot;age&quot;: 30 }'
curl -XPOST &quot;https://isdrWzc7nq:3MuCsPLpNRU9ofgA4GY&#64;demo-for-blog-6448511871.eu-central-1.bonsaisearch.net/demo/v1?pretty&amp;pretty&quot; -H 'Content-Type: application/json' -d' { &quot;name&quot;: &quot;user4&quot;, &quot;age&quot;: 40 }'
curl -XPOST &quot;https://isdrWzc7nq:3MuCsPLpNRU9ofgA4GY&#64;demo-for-blog-6448511871.eu-central-1.bonsaisearch.net/demo/v1?pretty&amp;pretty&quot; -H 'Content-Type: application/json' -d' { &quot;name&quot;: &quot;user5&quot;, &quot;age&quot;: 50 }'</pre>
<p>For all successful data upload we should see output similar to this:</p>
<pre class="literal-block">{
  &quot;_index&quot; : &quot;demo&quot;,
  &quot;_type&quot; : &quot;v1&quot;,
  &quot;_id&quot; : &quot;yZJVfGkBdm4qJtidx0HD&quot;,
  &quot;_version&quot; : 1,
  &quot;result&quot; : &quot;created&quot;,
  &quot;_shards&quot; : {
    &quot;total&quot; : 2,
    &quot;successful&quot; : 2,
    &quot;failed&quot; : 0
  },
  &quot;_seq_no&quot; : 0,
  &quot;_primary_term&quot; : 1
}</pre>
</div>
<div class="section" id="searching-data">
<h1>Searching Data</h1>
<p>Elasticsearch as the name says is used for searching. So let's search the index for <span class="docutils literal">user2</span>:</p>
<pre class="literal-block">curl -XGET &quot;https://isdrWzc7nq:3MuCsPLpNRU9ofgA4GY&#64;demo-for-blog-6448511871.eu-central-1.bonsaisearch.net/demo/_search?q=name:user2&amp;pretty&amp;pretty&quot;</pre>
<p>We should see this result like this:</p>
<pre class="literal-block">{
    &quot;took&quot;: 0,
    &quot;timed_out&quot;: false,
    &quot;_shards&quot;: {
        &quot;total&quot;: 1,
        &quot;successful&quot;: 1,
        &quot;skipped&quot;: 0,
        &quot;failed&quot;: 0
    },
    &quot;hits&quot;: {
        &quot;total&quot;: 1,
        &quot;max_score&quot;: 1.3862944,
        &quot;hits&quot;: [
            {
                &quot;_index&quot;: &quot;demo&quot;,
                &quot;_type&quot;: &quot;v1&quot;,
                &quot;_id&quot;: &quot;pnBWfGkBLqG7BIrR8Z0d&quot;,
                &quot;_score&quot;: 1.3862944,
                &quot;_source&quot;: {
                    &quot;name&quot;: &quot;user2&quot;,
                    &quot;age&quot;: 20
                }
            }
        ]
    }
}</pre>
</div>
<div class="section" id="update">
<h1>Update</h1>
<p>We can update the data stored in the index as well. We will update the age of <span class="docutils literal">user2</span> using two method but for use to update the age of we need to know the <span class="docutils literal">_id</span> of the document. We can use our previous result from search and can see that the <span class="docutils literal">_id</span> is <cite>pnBWfGkBLqG7BIrR8Z0d</cite>. Let's use it to update the age.</p>
<ol class="arabic">
<li><p>Fix value. Update a field with a fixed value.:</p>
<pre class="literal-block">curl -XPOST &quot;https://isdrWzc7nq:3MuCsPLpNRU9ofgA4GY&#64;demo-for-blog-6448511871.eu-central-1.bonsaisearch.net/demo/v1/pnBWfGkBLqG7BIrR8Z0d/_update&quot; -H 'Content-Type: application/json' -d' { &quot;doc&quot;: { &quot;age&quot;: 21 } }'</pre>
</li>
<li><p>Scripted updates. Update a filed with a scripts, in this case the current value of age field and update with 1.:</p>
<pre class="literal-block">curl -XPOST &quot;https://isdrWzc7nq:3MuCsPLpNRU9ofgA4GY&#64;demo-for-blog-6448511871.eu-central-1.bonsaisearch.net/demo/v1/pnBWfGkBLqG7BIrR8Z0d/_update?pretty&amp;pretty&quot; -H 'Content-Type: application/json' -d' { &quot;script&quot; : &quot;ctx._source.age += 1&quot; }'</pre>
</li>
</ol>
<p>In both case we should see output like this:</p>
<pre class="literal-block">{
  &quot;_index&quot;: &quot;demo&quot;,
  &quot;_type&quot;: &quot;v1&quot;,
  &quot;_id&quot;: &quot;pnBWfGkBLqG7BIrR8Z0d&quot;,
  &quot;_version&quot;: 2,
  &quot;result&quot;: &quot;updated&quot;,
  &quot;_shards&quot;: {
    &quot;total&quot;: 2,
    &quot;successful&quot;: 2,
    &quot;failed&quot;: 0
  },
  &quot;_seq_no&quot;: 5,
  &quot;_primary_term&quot;: 1
}</pre>
</div>
<div class="section" id="bonsai-and-python">
<h1>Bonsai and Python</h1>
<p>We can interact very easily with <a class="reference external" href="https://docs.bonsai.io/article/102-python">Bonsai using Python</a>. But if we need to use bare bone way we can use Python <span class="docutils literal">requests</span> library and use the Access Key and Access Secret as user name and password.:</p>
<pre class="literal-block">import requests
bonsai_url = &quot;https://demo-for-blog-6448511871.eu-central-1.bonsaisearch.net&quot;
user_name = &quot;isdrWzc7nq&quot;
password = &quot;3MuCsPLpNRU9ofgA4GY&quot;
index = &quot;demo&quot;
doc_type = &quot;v1&quot;
id = 1
field_names = [&quot;name&quot;,&quot;age&quot;]
user1 = [&quot;user1&quot;,10]
temp_dict = dict(zip(field_names,user1))
post_url = bonsai_url + &quot;/&quot; + index + &quot;/&quot; + doc_type + &quot;/&quot; + str(id)
header = {'Content-type': 'application/json', 'Accept': 'text/plain'}
post_response = requests.post(post_url, json=temp_dict, headers=header, auth=(user_name, password))
post_response.status_code #should give 201 if successful
post_response.content #should give something like this: b'{&quot;_index&quot;:&quot;demo&quot;,&quot;_type&quot;:&quot;v1&quot;,&quot;_id&quot;:&quot;1&quot;,&quot;_version&quot;:1,&quot;result&quot;:&quot;created&quot;,&quot;_shards&quot;:{&quot;total&quot;:2,&quot;successful&quot;:2,&quot;failed&quot;:0},&quot;_seq_no&quot;:8,&quot;_primary_term&quot;:1}'</pre>
</div>
<div class="section" id="deprovision-cluster">
<h1>Deprovision Cluster</h1>
<p>Make sure to deprovision your cluster once you are done.</p>
</div>
<div class="section" id="source">
<h1>Source</h1>
<ul class="simple">
<li><p><a class="reference external" href="https://stackoverflow.com/a/25471930">Create or update mapping in elasticsearch</a></p></li>
<li><p><a class="reference external" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/mapping.html">Mapping: Elasticsearch Doc</a></p></li>
<li><p><a class="reference external" href="http://docs.python-requests.org/en/master/user/authentication/#basic-authentication">Basic Authentication: Python Requests</a></p></li>
<li><p><a class="reference external" href="https://docs.bonsai.io/article/102-python">Bonsai using Python</a></p></li>
</ul>
</div>
</div>
<div class="footer">
<hr class="footer" />
<p><a class="reference external" href="/source/blogs/bonsai_an_elasticsearch_playground.rst">View document source</a>.
Generated on: 2020-05-12 11:06 UTC.
</p>

</div>
</body>
</html>
