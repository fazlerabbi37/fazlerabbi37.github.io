<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.14: http://docutils.sourceforge.net/" />
<title>TigerVNC starter guilde</title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 7952 2016-07-26 18:15:59Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

.subscript {
  vertical-align: sub;
  font-size: smaller }

.superscript {
  vertical-align: super;
  font-size: smaller }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

object[type="image/svg+xml"], object[type="application/x-shockwave-flash"] {
  overflow: hidden;
}

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title, .code .error {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left, table.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right, table.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

table.align-center {
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: inherit }

/* div.align-center * { */
/*   text-align: left } */

.align-top    {
  vertical-align: top }

.align-middle {
  vertical-align: middle }

.align-bottom {
  vertical-align: bottom }

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block, pre.math, pre.code {
  margin-left: 2em ;
  margin-right: 2em }

pre.code .ln { color: grey; } /* line numbers */
pre.code, code { background-color: #eeeeee }
pre.code .comment, code .comment { color: #5C6576 }
pre.code .keyword, code .keyword { color: #3B0D06; font-weight: bold }
pre.code .literal.string, code .literal.string { color: #0C5404 }
pre.code .name.builtin, code .name.builtin { color: #352B84 }
pre.code .deleted, code .deleted { background-color: #DEB0A1}
pre.code .inserted, code .inserted { background-color: #A3D289}

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

/* "booktabs" style (no vertical lines) */
table.docutils.booktabs {
  border: 0px;
  border-top: 2px solid;
  border-bottom: 2px solid;
  border-collapse: collapse;
}
table.docutils.booktabs * {
  border: 0px;
}
table.docutils.booktabs th {
  border-bottom: thin solid;
  text-align: left;
}

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
<style type="text/css">

body {
    padding: 40px;
}

.kbd
{
    -moz-border-radius:3px;
    -moz-box-shadow:0 1px 0 rgba(0,0,0,0.2),0 0 0 2px #fff inset;
    -webkit-border-radius:3px;
    -webkit-box-shadow:0 1px 0 rgba(0,0,0,0.2),0 0 0 2px #fff inset;
    background-color:#f7f7f7;
    border:1px solid #ccc;
    border-radius:3px;
    box-shadow:0 1px 0 rgba(0,0,0,0.2),0 0 0 2px #fff inset;
    color:#333;
    display:inline-block;
    font-family:Arial,Helvetica,sans-serif;
    font-size:15px;
    line-height:1.4;
    margin:0 .1em;
    padding:.1em .6em;
    text-shadow:0 1px 0 #fff;
}

</style>
</head>
<body>
<div class="document" id="tigervnc-starter-guilde">
<h1 class="title">TigerVNC starter guilde</h1>

<p><a class="reference external" href="../blog.html">&lt; Blog</a></p>
<p>This is a getting started guide with TigerVNC.</p>
<p>Created on: 2019-12-04</p>
<div class="section" id="installing-tigervnc-server">
<h1>Installing TigerVNC Server</h1>
<p>To install TigerVNC run the following:</p>
<pre class="literal-block">
sudo apt install tigervnc-standalone-server tigervnc-common -y
</pre>
<p>If our desktop environment is GNOME this additional package needs to install:</p>
<pre class="literal-block">
sudo apt install tigervnc-xorg-extension -y
</pre>
</div>
<div class="section" id="run-tigervnc-server">
<h1>Run TigerVNC Server</h1>
<p>To run TigerVNC Server:</p>
<pre class="literal-block">
vncserver
</pre>
<p>We will see the following output:</p>
<pre class="literal-block">
You will require a password to access your desktops.

Password:
Verify:
Would you like to enter a view-only password (y/n)? n
/usr/bin/xauth:  file /home/user/.Xauthority does not exist

New 'hostname:1 (user)' desktop at :1 on machine hostname

Starting applications specified in /etc/X11/Xvnc-session
Log file is /home/user/.vnc/debian9.localdomain:1.log

Use xtigervncviewer -SecurityTypes VncAuth -passwd /home/user/.vnc/passwd :1 to connect to the VNC server.
</pre>
</div>
<div class="section" id="configuring-gnome-desktop-environment">
<h1>Configuring GNOME Desktop environment</h1>
<p>For this we need to create a file name <cite>~/.vnc/xstartup</cite>. Let's start by open a file with favourite our text editor. I am using vim:</p>
<pre class="literal-block">
vim ~/.vnc/xstartup
</pre>
<p>Now paste the following code:</p>
<pre class="literal-block">
#!/bin/bash
# Start Gnome Desktop
[ -x /etc/vnc/xstartup ] &amp;&amp; exec /etc/vnc/xstartup
[ -r $HOME/.Xresources ] &amp;&amp; xrdb $HOME/.Xresources
vncconfig -iconic &amp;
dbus-launch --exit-with-session gnome-session &amp;
</pre>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If we see <cite>dbus-launch</cite> error, we need to install <cite>dbus-x11</cite> package. In ubuntu we can do this with <cite>sudo apt install dbus-x11 -y</cite></p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>If this script is not used we may see the following error:</p>
<pre class="last literal-block">
server: Failed command '/etc/X11/Xvnc-session': 256!

=================== tail -15 /$USER/.vnc/$HOST:1.log ===================
See http://www.tigervnc.org for information on TigerVNC.
Underlying X server release 12004000, The X.Org Foundation


Fri Jan  5 71:03:23 2091
 vncext:      VNC extension running!
 vncext:      Listening for VNC connections on local interface(s), port 5901
 vncext:      created VNC server for screen 0
XIO:  fatal IO error 11 (Resource temporarily unavailable) on X server &quot;:1&quot;
      after 173 requests (173 known processed) with 0 events remaining.

Fri Jan  5 71:03:33 2091
 ComparingUpdateTracker: 0 pixels in / 0 pixels out
 ComparingUpdateTracker: (1:-nan ratio)
Killing Xtigervnc process ID 5137... which seems to be deadlocked. Using SIGKILL!

======================================================================

Starting applications specified in /etc/X11/Xvnc-session has failed.
Maybe try something simple first, e.g.,
        tigervncserver -xstartup /usr/bin/xterm
</pre>
</div>
<p>VNC is not an encrypted protocol and can be subject to packet sniffing. So is by default when it starts it only accept connections from the localhost interface. We will need to use SSH tunnel to connect to the remote host. We will how to do that later in <a class="reference internal" href="#view-from-local-host">View from local host</a> section.</p>
<p>But if you are not concern about security like you are running a VM on local network then and sure about security then you can allow accepting connections from all interfaces by runnnig:</p>
<pre class="literal-block">
vncserver -localhost no
</pre>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">as of Today(2019-12-09) the systemd is not working. please skip it until I fix it.</p>
</div>
</div>
<div class="section" id="creating-a-systemd-unit-file">
<h1>Creating a Systemd unit file</h1>
<p>The systemd unit file will allow us to easily start, stop, and restart the VNC service as needed. Now we need to open a file with favourite our text editor. I am using vim:</p>
<pre class="literal-block">
sudo vim /etc/systemd/system/vncserver&#64;.service
</pre>
<p>PS: if we are using vim it would be a good time to enable paste mode with <span class="kbd">Esc</span> then <span class="kbd">:</span> the type <cite>set paste</cite></p>
<p>Now paste the following lines in that file:</p>
<pre class="literal-block">
[Unit]
Description=Remote desktop service (VNC)
After=syslog.target network.target

[Service]
Type=simple
User=$USER
PAMName=login
PIDFile=/home/%u/.vnc/%H%i.pid
ExecStartPre=/bin/bash -c '/usr/bin/vncserver -kill :%i &gt; /dev/null 2&gt;&amp;1 || :'
# this start vncserver to accept connection from localhost only so need to use SSH tunnel
ExecStart=/usr/bin/vncserver :%i -geometry 1440x900 -autokill
# this start vncserver to accept connection from all interface so this is insecure. only use this if you know what you are doing
# ExecStart=/usr/bin/vncserver :%i -localhost no -geometry 1440x900 -autokill
ExecStop=/usr/bin/vncserver -kill :%i

[Install]
WantedBy=multi-user.target
</pre>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">maybe we should move the config like -geometry, -autokill and -localhost to config file</p>
</div>
<p>If we notice the code for the systemd file we will see:</p>
<ul class="simple">
<li>In line 6 we have a <cite>$USER</cite> variable. We need to replace that to our user name.</li>
<li>In line 11 we have used the <cite>vncserver</cite> command to start the vncserver to only accept connections from localhost interface. This is recommended and used by default. To connect from remote host we must use SSH tunnel mentioned in the previous section.</li>
<li>In line 13 we have used the <cite>vncserver</cite> command to start the vncserver to only accept connections from all interfaces. This is NOT recommended and thus commented out. If you want to use it comment out line 11 and uncomment this (13) line. We mast run <cite>sudo systemctl daemon-reload</cite> to see the effect of our change in vncserver&#64;.service.</li>
</ul>
<p>Now let's proceed to using the systemd file. First save the file and then run:</p>
<pre class="literal-block">
sudo systemctl daemon-reload
</pre>
<p>Next, enable the service:</p>
<pre class="literal-block">
sudo systemctl enable vncserver&#64;1.service
</pre>
<p>The number <cite>1</cite> after the <cite>&#64;</cite> sign defines the display port on which the VNC service will run. As we discussed in the previous section since we are using <cite>1</cite> the VNC server will listen on port <cite>5901</cite></p>
<p>Start the VNC service by executing:</p>
<pre class="literal-block">
sudo systemctl start vncserver&#64;1.service
</pre>
<p>Verify that the service is successfully started with:</p>
<pre class="literal-block">
sudo systemctl status vncserver&#64;1.service
</pre>
</div>
<div class="section" id="view-from-local-host">
<h1>View from local host</h1>
<p>The recommended approach is to create an <a class="reference external" href="https://linuxize.com/post/how-to-setup-ssh-tunneling/">SSH tunnel</a> that will securely forwards traffic from our local host on port 5901 to the server on the same port. To setup port forwarding run:</p>
<pre class="literal-block">
ssh -L 5901:127.0.0.1:5901 -N -f -l $USERNAME $SERVER_IP_ADDRESS
</pre>
<p>Now we will install a VNC viwer in our local host:</p>
<pre class="literal-block">
sudo apt install tigervnc-viewer -y
</pre>
<p>Or you can use the <a class="reference external" href="https://remmina.org/">Remmina</a> if you are in Ubuntu.</p>
<p>If you used port forwarding then put <cite>127.0.0.1:5901</cite> in and connect.</p>
<p>If you used <cite>-localhost no</cite> the put the ip address of the remote host and connect.</p>
</div>
<div class="section" id="source">
<h1>Source</h1>
<ul class="simple">
<li><a class="reference external" href="https://linuxize.com/post/how-to-install-and-configure-vnc-on-debian-9/">How to Install and Configure VNC on Debian 9</a></li>
<li><a class="reference external" href="https://www.cyberciti.biz/faq/install-and-configure-tigervnc-server-on-ubuntu-18-04/">Install and Configure TigerVNC server on Ubuntu 18.04</a></li>
<li><a class="reference external" href="https://askubuntu.com/a/1159514/502875">Unable to connect through VNC</a></li>
<li><a class="reference external" href="https://www.digitalocean.com/community/tutorials/how-to-install-and-configure-vnc-on-ubuntu-18-04">How to Install and Configure VNC on Ubuntu 18.04</a></li>
<li><a class="reference external" href="https://bbs.archlinux.org/viewtopic.php?pid=1648878#p1648878">https://bbs.archlinux.org/viewtopic.php?pid=1648878#p1648878</a></li>
<li><a class="reference external" href="https://wiki.archlinux.org/index.php/TigerVNC">https://wiki.archlinux.org/index.php/TigerVNC</a></li>
</ul>
</div>
</div>
<div class="footer">
<hr class="footer" />
Generated on: 2019-12-09 11:15 UTC.

</div>
</body>
</html>
